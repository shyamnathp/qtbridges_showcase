<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=1920, height=1080, maximum-scale=1.0, user-scalable=no">

  <title>QtBridges for Python - Workshop</title>

  <link rel="stylesheet" href="reveal.js/dist/reset.css">
  <link rel="stylesheet" href="reveal.js/dist/reveal.css">
  <link rel="stylesheet" href="reveal.js/dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="css/qt-night.css">
  <link rel="stylesheet" href="css/extras.css">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css">

  <!-- Mermaid.js for diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#41CD52',
        primaryTextColor: '#fff',
        primaryBorderColor: '#41CD52',
        lineColor: '#1E90FF',
        secondaryColor: '#1E90FF',
        tertiaryColor: '#FFD43B'
      }
    });
  </script>

  <!-- Printing and PDF exports -->
  <script>
    if( window.location.search.match( /print-pdf/gi ) ) {
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = 'reveal.js/css/print/pdf.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
    Reveal.configure({
      width: 1920,
      height: 1080,
      margin: 0.5, // Adjust margins for better fit
      pdfMaxPagesPerSlide: 1,
      pdfSeparateFragments: false,
    });
  </script>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <div style="
          display: flex;
          flex-direction: column;
          align-items: left;
          justify-content: center;
          position: relative;">
          <!-- Add Python logo as background -->
          <img src="img/python.svg" style="
            position: absolute;
            left: 82%;
            top: 44%;
            transform: translate(-50%, -50%);
            width: 184px;" />
          <h3 style="position: relative; z-index: 1; text-align: left;">
            <span style="color:#FFD43B;">QtBridges</span> -
            <span>API Review</span> for
            <span style="color:#1E90FF;">Python</span>
          </h3>
          <hr class="qt-line" style="border: 2px solid #41CD52; width: 50%; margin: 10px 0; position: relative; z-index: 1;" />
          <p class="x80" style="position: relative; z-index: 1; text-align: left;">
            <i class="qt-green">Shyamnath</i> Premnadh<br/>
          </p>
        </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2>‚öôÔ∏è Internal Overview</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; font-size: 80%;">
          <!-- Left column: Key points -->
          <div>
            <ul>
              <li class="fragment">Python object wrapped as <span style="color:#1E90FF;">QAbstractItemModel (QAIM)</span></li>
              <li class="fragment">Public methods &rarr; Slots (added dynamically)</li>
              <li class="fragment">Python <code>@property</code> &rarr; Qt Properties
                <ul>
                  <li class="fragment">Change signals <span style="color:#FFD43B;">auto-emit</span> when set from QML</li>
                </ul>
              </li>
              <li class="fragment">QML calls via overridden <code>QAIM::qt_metacall()</code></li>
            </ul>
          </div>

          <!-- Right column: Mermaid diagram -->
          <div>
            <pre class="mermaid" style="font-size: 2.2em; min-width: 600px; min-height: 500px; line-height: 1.2;">graph TB
A[Python Object] -->|Wrapped as| B[QAIM Wrapper]
B -->|Creates| C[Dynamic Meta-Object]
C -->|Registers| D[Methods as Slots]
C -->|Registers| E[Properties]
F[QML Call] -->|Invokes| G[qt_metacall]
G -->|Forwards to| H[Python Method]
E -.->|Auto-emit on set from QML| I[propertyChanged Signal]

style A fill:#1E90FF,stroke:#fff,color:#fff
style B fill:#41CD52,stroke:#fff,color:#fff
style C fill:#FFD43B,stroke:#333,color:#333
style D fill:#41CD52,stroke:#fff,color:#fff
style E fill:#41CD52,stroke:#fff,color:#fff
style G fill:#41CD52,stroke:#fff,color:#fff
style H fill:#1E90FF,stroke:#fff,color:#fff
style I fill:#FFD43B,stroke:#333,color:#333
</pre>
          </div>
        </div>

        <aside class="notes">
        Technical Deep Dive:
        - Uses QMetaObjectBuilder to construct dynamic meta-object
        - Method signatures extracted from Python type hints (inspect module)
        - All public methods registered as QMetaMethod::Slot
        - qt_metacall() in AutoQmlBridgeModel handles interception
        - Property notify signals only emit when set from QML, not Python
        </aside>
      </section>
      <!--***************************************************************************-->

      <section data-transition="slide-in fade-out">
          <h2><span style="color:#41CD52;">QtBridges</span> API Overview (1/2)</h2>
          <div style="font-size: 85%;">
            <h3 style="color:#1E90FF;">Core Functions</h3>
            <ul>
              <li class="fragment"><code style="color:#41CD52;">bridge_instance()</code> ‚Äì Expose Python object as QML singleton</li>
              <li class="fragment"><code style="color:#41CD52;">bridge_type()</code> ‚Äì Register Python class as QML type</li>
              <li class="fragment"><code style="color:#41CD52;">@qtbridge</code> ‚Äì Application setup decorator</li>
            </ul>
          </div>
        </section>

        <section data-transition="slide-in fade-out">
          <h2><span style="color:#41CD52;">QtBridges</span> API Overview (2/2)</h2>
          <div style="font-size: 85%;">
            <h3 style="color:#1E90FF;">Model Change Decorators</h3>
            <ul>
              <li class="fragment"><code style="color:#FFD43B;">@insert</code> &rarr; <code>beginInsertRows()</code>/<code>endInsertRows()</code></li>
              <li class="fragment"><code style="color:#FFD43B;">@remove</code> &rarr; <code>beginRemoveRows()</code>/<code>endRemoveRows()</code></li>
              <li class="fragment"><code style="color:#FFD43B;">@edit</code> &rarr; <code>dataChanged()</code></li>
              <li class="fragment"><code style="color:#FFD43B;">@move</code> &rarr; <code>beginMoveRows()</code>/<code>endMoveRows()</code></li>
              <li class="fragment"><code style="color:#FFD43B;">@reset</code> &rarr; <code>beginResetModel()</code>/<code>endResetModel()</code></li>
            </ul>
          </div>
        </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2><code style="color:#41CD52;">@qtbridge</code> Decorator</h2>
        <div style="font-size: 75%;">
          <pre><code class="python" data-noescape>def qtbridge(
    module: str | None = None,
    type_name: str | None = None,
    qml_file: str | None = None,
    import_paths: List[str] | None = None
) -> Callable</code></pre>

        <div class="fragment" style="margin-top: 8px; font-size: 90%; margin-left: -18px;"><b>Abstracts the creation of Qt event loop and QML engine</b></div>
        <ul style="font-size: 90%;">
          <li class="fragment"><code>module</code>: QML module name (looks for <code>&lt;module&gt;.qml</code>)</li>
          <li class="fragment"><code>type_name</code>: Specific QML component to instantiate</li>
          <li class="fragment"><code>qml_file</code>: Direct path to QML file</li>
          <li class="fragment"><code>import_paths</code>: Additional directories for QML imports</li>
        </ul>

        <aside class="notes">
          <ul>
            <li>Simplifies QML application setup</li>
            <li>Automatically initializes <code>QGuiApplication</code> and <code>QQmlApplicationEngine</code></li>
            <li>Handles QML file loading and engine lifecycle</li>
            <li>Manages application event loop</li>
          </ul>
        </aside>
        </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2><code style="color:#41CD52;">bridge_instance()</code> - Python object</h2>
        <div style="font-size: 75%;">
          <pre><code class="python" data-noescape>def bridge_instance(
    instance: DataProvider,
    name: str,
    uri: str = "backend"
) -> None</code></pre>

        <div class="fragment" style="margin-top: 8px; font-size: 90%; margin-left: -18px;"><b>Creates a QML singleton</b> accessible by <code>name</code> in QML</div>

        <ul style="font-size: 90%;">
          <li class="fragment"><code>instance</code>: Python object with <code>data()</code> method</li>
          <li class="fragment"><code>name</code>: QML singleton name (must start with uppercase)</li>
          <li class="fragment"><code>uri</code>: QML module namespace (default: "backend")</li>
        </ul>

        <aside class="notes">
        Implementation Details:
        - Creates a QAbstractItemModel wrapper internally
        - Dynamically modifies meta-object to add slots for each public Python method
        - Uses QMetaObject::qt_metacall() to forward calls to Python methods
        - Requires data() method with type hint to expose data through QAIM's data()
        - Property setters called from QML emit propertyNameChanged signals automatically
        </aside>
        </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2><code style="color:#41CD52;">bridge_instance()</code> - Sequence Containers</h2>
        <div style="font-size: 75%;">
          <pre><code class="python" data-noescape>def bridge_instance(
    obj: list | tuple | numpy.ndarray,
    name: str,
    uri: str = "backend"
) -> None</code></pre>

          <div class="fragment" style="margin-top: 8px; font-size: 90%; margin-left: -18px;"><b>Internally a QRangeModel</b> (not a QAIM)</div>

          <ul style="font-size: 90%;">
            <li class="fragment"><code>obj</code>: The Python container to expose (can be a <code>list</code>, <code>tuple</code>, or <code>numpy.ndarray</code>).</li>
            <li class="fragment"><code>name</code>: The name used to access the model in QML.</li>
            <li class="fragment"><code>uri</code>: The QML module namespace (default: <code>"backend"</code>;).</li>
          </ul>

            <aside class="notes">
            Implementation Details:
            - Wraps container in QRangeModel (custom QAIM subclass)
            - Creates a snapshot at registration time
            - Limitation: Post-registration modifications to original Python container are not reflected in QML
            - QML modifications via QRangeModel do not update the original Python container
            - For dynamic models, use the class variant with @insert/@remove decorators
            </aside>
          </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2><code style="color:#41CD52;">bridge_type()</code></h2>
        <div style="font-size: 68%;">
          <pre><code class="python" data-noescape>def bridge_type(
    type: type,
    uri: str,
    version: str,
    name: str | None = None,
    default_property: str | None = None
) -> None</code></pre>

        <div class="fragment" style="margin-top: 8px; font-size: 90%; margin-left: -18px;"><b>Used to create a Python object from QML</b></div>

        <ul style="font-size: 85%;">
          <li class="fragment"><code>type</code>: Python class to register</li>
          <li class="fragment"><code>uri</code>: QML module namespace</li>
          <li class="fragment"><code>version</code>: Version string (e.g., "1.0")</li>
          <li class="fragment"><code>name</code>: Custom QML type name (defaults to class name)</li>
          <li class="fragment"><code>default_property</code>: Property for default child assignment in QML</li>
        </ul>

        <aside class="notes">
        Implementation Details:
        - Registers Python class as instantiable QML type
        - Internally creates QAIM wrapper with dynamic meta-object
        - Public methods become slots via qt_metacall() forwarding
        - Property setters emit propertyNameChanged when called from QML
        - QML can create multiple instances of the registered type
        </aside>
        </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2 style="text-align: center;">Model Decorators in Action</h2>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2>üîÑ Type Conversion</h2>
        <div style="font-size: 80%;">
          <table style="width: 100%; border-collapse: collapse; font-size: 85%;">
        <thead>
          <tr style="background-color: #41CD52;">
            <th style="border: 1px solid #ddd; padding: 8px;">Python Type</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Qt/C++ Type</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>int</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>int / long long</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>float</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>double</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>str</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QString</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>bool</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>bool</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>list</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QVariantList</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>dict</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QVariantMap</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>None</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QVariant()</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>dataclass</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QVariantMap (fields as keys/values)</code></td>
          </tr>
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>custom Python object</code></td>
            <td style="border: 1px solid #ddd; padding: 8px;"><code>QVariant(PySide::PyObjectWrapper)</code></td>
          </tr>
        </tbody>
          </table>
        </div>
      </section>
      <!--***************************************************************************-->

      <!--***************************************************************************-->
      <section data-transition="slide-in fade-out">
        <h2>‚ö†Ô∏è Limitations</h2>
        <div style="font-size: 80%;">
          <ul>
            <li class="fragment"><b>Type hints required</b> for all properties and methods.</li>
            <li class="fragment"><b>No custom signals</b>‚Äîauto-generated only, and only emit when set from QML.</li>
            <li class="fragment"><b>Container (QRangeModel case) updates not tracked</b> after registration with <code>bridge_instance()</code>.</li>
            <li class="fragment"><b>Model decorators</b> (<code>@insert</code>, <code>@remove</code>, etc.) <b>only work with</b> <code>bridge_instance()</code>.</li>
            <li class="fragment"><b>Current types support</b>‚Äîuse <span style="color:#FFD43B;">primitive types</span>, <span style="color:#41CD52;">lists</span>, <span style="color:#1E90FF;">Python dataclasses</span>.</li>
          </ul>
        </div>
      </section>
      <!--***************************************************************************-->

        <section data-transition="slide-in fade-out">
        <h2>üöß Work In Progress</h2>
        <div style="font-size: 85%;">
          <ul>
            <li class="fragment">
              <b>@complete Decorator</b>
              <ul>
                <li class="fragment">Maps to QML's <code>Component.onCompleted</code> via <code>QQmlParserStatus::componentComplete()</code></li>
                <li class="fragment">Allows Python initialization logic after QML component is fully loaded</li>
                  <pre class="fragment" style="font-size: 60%; margin-top: 10px;"><code class="python" data-noescape>class MyModel:
          @complete
          def on_component_complete(self):
              self.load_initial_data()
              print("Component is ready!")</code></pre>
              </ul>
            </li>
            <li class="fragment">
              <b>Model Decorators for <code>bridge_type()</code></b>
              <ul>
                <li class="fragment">Enable <code>@insert</code>, <code>@remove</code>, <code>@edit</code>, <code>@move</code>, <code>@reset</code> for types registered with <code>bridge_type()</code></li>
                <li class="fragment">Provides consistent API for both instance and type registration</li>
                <li class="fragment">Makes QML-instantiated objects fully feature-complete with QAIM change notifications</li>
              </ul>
            </li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h2>üî≠ In Planning</h2>
        <div style="font-size: 90%;">
          <ul>
            <li class="fragment"><b>Table Data Support</b> ‚Äì Pandas DataFrames & SQLite integration</li>
            <li class="fragment"><b>QRangeModel Improvements</b> ‚Äì Bidirectional sync between Python and QML</li>
            <li class="fragment"><b>Python‚ÜíQML Signals</b> ‚Äì Emit property changes from Python code</li>
          </ul>
        </div>
        <aside class="notes">
          Table Data Support:
          - Native integration with Pandas DataFrames and SQLite databases
          - Automatic column detection and role mapping
          - Built-in sorting, filtering, and pagination
          - Efficient incremental updates without full model resets

          QRangeModel Improvements:
          - Make QRangeModel behave like original Python container
          - Bidirectional synchronization between Python and QML
          - Full attribute and method access passthrough

          Signal Emission from Python:
          - Allow property change signals to emit when properties are modified from Python code
          - Enable Python‚ÜíQML function calls and signal emission
          - Full bidirectional communication without manual QMetaObject.invokeMethod()
        </aside>
      </section>

    </div>
  </div>

  <script src="reveal.js/dist/reveal.js"></script>
  <script src="reveal.js/plugin/notes/notes.js"></script>
  <script src="reveal.js/plugin/markdown/markdown.js"></script>
  <script src="reveal.js/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
      hash: true,
      transitionSpeed: 'fast',
      width: 960, // Default slide width
      height: 700, // Default slide height
      margin: 0.1, // Margin around the content
      minScale: 0.5, // Minimum scaling factor
      maxScale: 2.0, // Maximum scaling factor
      // Learn about plugins: https://revealjs.com/plugins/
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
      });

    Chart.register(ChartDataLabels);
    const ctx = document.getElementById('qtGrowthChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['2023', '2024'],
        datasets: [{
          label: 'Qt Learning Interest',
          data: [6.78, 10.1],
          borderColor: '#41CD52',
          backgroundColor: 'rgba(65, 205, 82, 0.2)',
          tension: 0.4,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 20,
            right: 20,
            bottom: 20,
            left: 20
          }
        },
        plugins: {
          title: {
            display: false
          },
          tooltip: {
            enabled: true
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 12,
            ticks: {
              callback: function(value) {
                return value + '%';
              }
            }
          }
        },
        plugins: {
          datalabels: {
            anchor: 'end',
            align: 'top',
            formatter: function(value) {
              return value + '%';
            },
            font: {
              weight: 'bold'
            }
          }
        }
      }
    });
  </script>

  <script src="socket.io/socket.io.js"></script>
  <script src="node_modules/reveal-notes-server/client.js"></script>
  <!-- Hack to have a footer-->

  <!-- 1. Style header/footer <div> so they are positioned as desired: in css/qt.css -->
  <!-- 2. Create hidden header/footer <div> -->
  <div id="hidden" style="display:none;">
    <div id="header">
      <!-- <div id="header-left"><img src="img/qt.png" style="width: 100px;margin-left: 30px;" /></div> -->
      <!-- <div id="footer-left"></div> -->
      <div id="header-right"></div>
      <div id="footer-left">
        <img src="img/qt_logo.webp" style="width: 32px" />
        <p style="font-size: 14pt; padding-left: 5px;">
          <i class="white">QtBridges | 28th November, 2025</i>
      </div>
  </div>

  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script type="text/javascript">
    // 3. On Reveal.js ready event, copy header/footer <div> into each `.slide-background` <div>
    var header = $('#header').html();
    if ( window.location.search.match( /print-pdf/gi ) ) {
      Reveal.addEventListener( 'ready', function( event ) {
        $('.slide-background').append(header);
      });
    }
    else {
      $('div.reveal').append(header);
     }

     // speaker notes line break
     let notes = document.querySelectorAll('aside.notes');
     notes.forEach(n => {
       let html = n.innerHTML;
       html = html.trim().replace(/\n/g, '<br/>');
       n.innerHTML = html;
     });
  </script>

  <script>
    showQr();
  </script>
</body>
</html>
